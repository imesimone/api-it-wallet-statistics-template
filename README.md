# Entra con IT-Wallet - Statistics API Template

Standard OpenAPI template for monitoring and statistics services dedicated to the **"Entra con IT-Wallet"** authentication flow.

## üìå Overview
This repository provides the "Entra con IT-Wallet Statistics" OpenAPI specification designed for **Regional Hubs** and **Technical Aggregators**.
## üöÄ Getting Started

### Placeholder Replacement
The placeholders within the YAML specification (e.g., entity domains, contact emails, and service names) are automatically handled and replaced by the **PDND (Piattaforma Digitale Nazionale Dati)** when this template is implemented and published.

## üõ† API Design Principles

### 1. Flexible Query Interface
To handle complex filtering without URL length limitations, statistics are retrieved via `POST` methods:
- `/auth-stats/summary`: Global aggregated report for the requested period.
- `/auth-stats/breakdown`: Detailed, paginated list of metrics.

### 2. Time Range & Granularity
- **Inclusive Dates**: Filters use `from` and `to` (ISO 8601), both inclusive.
- **Dynamic Granularity**: Support for `daily`, `monthly` (default), `yearly`, and `total` views.
- **Reporting Period**: The response includes the actual period covered by the data, ensuring transparency if data is unavailable for certain ranges (e.g., future dates or before service launch).

### 3. Failure Categorization
Failures are categorized to facilitate troubleshooting:
- **technical**: Infrastructure, server-side, or connectivity issues (Aggregator responsibility).
- **business**: Token expiration, unauthorized access, or logic-level issues (User/Client responsibility).

### 4. Pagination of Time Buckets
In the breakdown endpoint, `limit` and `offset` paginate the **time-based entries (buckets)** generated by the query.
- **Example**: If a `daily` granularity is requested for a full year (365 days), the API will generate 365 breakdown entries.
- **Usage**: A client can use `limit: 30` and `offset: 0` to retrieve the first month of daily data.
- **Total Items**: The `pagination.totalItems` field represents the total number of buckets within the requested `period`.

## üìä Examples
For a detailed list of request and response examples covering various scenarios (Global Summary, Daily IPA breakdown, Monthly Hub trends, Yearly custom periods, and Pagination), please refer to the [Examples Directory](examples/README.md).

## üîí Compliance & Headers

To ensure interoperability and security, the following standards are implemented:

- **Cache-Control**: Strict policy (`no-store`, `no-cache`, `private`, `max-age=0`) to prevent stale data usage or leaks.
- **Rate-Limiting**: Uses `X-RateLimit-*` headers to communicate quotas.
- **Retry-After**: Provided in `429` (Too Many Requests) and `503` (Service Unavailable) responses. When present, `X-RateLimit` headers are omitted to avoid ambiguity and compliance with RFCs.
- **Problem Details**: Error responses follow **RFC 7807** (`application/problem+json`).

## ‚öñÔ∏è License
This project is licensed under the **European Union Public Licence (EUPL-1.2)**. See the `LICENSE` file for details.
